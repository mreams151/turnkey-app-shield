# GitHub & Cloudflare Connection Guide for New Conversations

## Quick Setup Summary for AI Assistant

This document contains all the information needed to connect to your existing GitHub repository and Cloudflare deployment in a new conversation.

---

## GitHub Repository Information

### Repository Details:
- **Repository URL**: `https://github.com/mreams151/turnkey-app-shield`
- **Owner**: `mreams151`
- **Repository Name**: `turnkey-app-shield`
- **Main Branch**: `main` (default branch for all operations)
- **Project Path**: `/home/user/webapp/` (for local development)

### GitHub Authentication Setup:
```bash
# CRITICAL: Always run this FIRST before any GitHub operations
setup_github_environment

# This tool automatically:
# - Configures git credentials globally
# - Sets up GitHub CLI authentication  
# - Provides access to user's selected repositories
# - No manual token setup required
```

### Repository Management Commands:
```bash
# Clone repository
git clone https://github.com/mreams151/turnkey-app-shield.git

# Navigate to project
cd turnkey-app-shield

# Check status
git status

# Add and commit changes
git add -A
git commit -m "Your commit message"

# Push to main branch
git push origin main

# Check recent commits
git log --oneline -5
```

---

## Cloudflare Pages & Workers Information

### Cloudflare Project Details:
- **Pages Project Name**: `turnkey-app-shield`
- **Domain**: Auto-generated by Cloudflare Pages
- **Production Branch**: `main`
- **Build Command**: `npm run build`
- **Output Directory**: `dist`

### Cloudflare Authentication Setup:
```bash
# CRITICAL: Always run this FIRST before any Cloudflare operations
setup_cloudflare_api_key

# This tool automatically:
# - Configures CLOUDFLARE_API_TOKEN environment variable
# - Validates API key permissions
# - Sets up wrangler authentication
# - No manual token setup required
```

### Cloudflare Resources Configuration:

#### D1 Database (SQLite):
```jsonc
"d1_databases": [
  {
    "binding": "DB",
    "database_name": "turnkey-app-shield-production", 
    "database_id": "cd02dc64-14ee-40d5-838f-143844955d0c"
  }
]
```

#### KV Storage:
```jsonc
"kv_namespaces": [
  {
    "binding": "CACHE",
    "id": "04fe2ec769584fa284bbe384a6bb23e7",
    "preview_id": "04fe2ec769584fa284bbe384a6bb23e7"
  }
]
```

### Meta Information Management:
```bash
# CRITICAL: Always manage cloudflare_project_name using meta_info tool
meta_info(action="read", key="cloudflare_project_name")
meta_info(action="write", key="cloudflare_project_name", value="turnkey-app-shield")
```

---

## Required Environment Variables

### Cloudflare Pages Secrets (Production):
These must be set in Cloudflare Pages dashboard under Settings → Environment Variables:

```
JWT_SECRET=TAS-2024-super-secret-jwt-key-for-turnkey-app-shield-production
ADMIN_USERNAME=admin  
ADMIN_PASSWORD=YourSecurePassword123!
MAX_ACTIVATIONS_PER_LICENSE=3
```

### Local Development (.dev.vars file):
```
JWT_SECRET=local-dev-secret-key
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
MAX_ACTIVATIONS_PER_LICENSE=3
```

---

## Project Structure Overview

```
turnkey-app-shield/
├── src/
│   ├── index.tsx              # Main application entry point
│   ├── routes/               # API route handlers  
│   │   ├── admin.ts         # Admin panel routes
│   │   └── license.ts       # License management APIs
│   ├── types/               # TypeScript definitions
│   └── utils/               # Utility functions
├── migrations/
│   └── 0001_modern_schema.sql # Database schema
├── public/static/            # Static assets (CSS, JS, images)
├── wrangler.jsonc           # Cloudflare configuration
├── package.json             # Dependencies and scripts
├── vite.config.ts           # Build configuration  
└── ecosystem.config.cjs     # PM2 configuration
```

---

## Development Workflow Commands

### Standard Development Sequence:
```bash
# 1. Setup authentication (FIRST STEP)
setup_github_environment
setup_cloudflare_api_key

# 2. Clone and navigate
cd /home/user && git clone https://github.com/mreams151/turnkey-app-shield.git
cd turnkey-app-shield

# 3. Install dependencies (300s timeout)
npm install

# 4. Build application (300s timeout)
npm run build

# 5. Apply database migrations (local development)
npx wrangler d1 migrations apply turnkey-app-shield-production --local

# 6. Start development server with PM2
fuser -k 3000/tcp 2>/dev/null || true  # Clean port first
pm2 start ecosystem.config.cjs

# 7. Test deployment
curl http://localhost:3000
curl http://localhost:3000/api/health

# 8. Get public URL for testing
GetServiceUrl(port=3000, service_name="TurnkeyAppShield")
```

### Production Deployment Sequence:
```bash
# 1. Build application
npm run build

# 2. Deploy to Cloudflare Pages  
npx wrangler pages deploy dist --project-name turnkey-app-shield

# 3. Apply database migrations (production)
npx wrangler d1 migrations apply turnkey-app-shield-production

# 4. Verify deployment
curl https://turnkey-app-shield.pages.dev
curl https://turnkey-app-shield.pages.dev/api/health
```

---

## Critical Configuration Files

### wrangler.jsonc:
```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "turnkey-app-shield",
  "compatibility_date": "2025-01-01",
  "compatibility_flags": ["nodejs_compat"],
  "pages_build_output_dir": "./dist",
  
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "turnkey-app-shield-production",
      "database_id": "cd02dc64-14ee-40d5-838f-143844955d0c"
    }
  ],
  
  "kv_namespaces": [
    {
      "binding": "CACHE", 
      "id": "04fe2ec769584fa284bbe384a6bb23e7",
      "preview_id": "04fe2ec769584fa284bbe384a6bb23e7"
    }
  ],
  
  "vars": {
    "ENVIRONMENT": "development",
    "API_VERSION": "v2", 
    "MAX_ACTIVATIONS_PER_MINUTE": "100",
    "SYSTEM_NAME": "TurnkeyAppShield"
  }
}
```

### package.json (Key Scripts):
```json
{
  "scripts": {
    "dev": "vite",
    "dev:sandbox": "wrangler pages dev dist --d1=turnkey-production --local --ip 0.0.0.0 --port 3000",
    "build": "vite build", 
    "deploy": "npm run build && wrangler pages deploy dist",
    "deploy:prod": "npm run build && wrangler pages deploy dist --project-name turnkey-app-shield",
    "db:migrate:local": "wrangler d1 migrations apply turnkey-app-shield-production --local",
    "db:migrate:prod": "wrangler d1 migrations apply turnkey-app-shield-production",
    "test": "curl http://localhost:3000",
    "start:pm2": "pm2 start ecosystem.config.cjs"
  }
}
```

### ecosystem.config.cjs (PM2):
```javascript
module.exports = {
  apps: [
    {
      name: 'turnkey-app-shield',
      script: 'npx',
      args: 'wrangler pages dev dist --d1=turnkey-app-shield-production --local --ip 0.0.0.0 --port 3000',
      env: {
        NODE_ENV: 'development',
        PORT: 3000
      },
      watch: false,
      instances: 1,
      exec_mode: 'fork'
    }
  ]
}
```

---

## Important URLs & Endpoints

### Development URLs (Local):
- **Homepage**: `http://localhost:3000`
- **Admin Panel**: `http://localhost:3000/admin`
- **Customer Portal**: `http://localhost:3000/portal`
- **API Health**: `http://localhost:3000/api/health`
- **API Info**: `http://localhost:3000/api/info`

### Production URLs (Cloudflare):
- **Homepage**: `https://turnkey-app-shield.pages.dev`
- **Admin Panel**: `https://turnkey-app-shield.pages.dev/admin`  
- **Customer Portal**: `https://turnkey-app-shield.pages.dev/portal`
- **API Health**: `https://turnkey-app-shield.pages.dev/api/health`

### Key API Endpoints:
```
POST /api/license/validate       # License validation (main endpoint)
POST /api/admin/auth/login       # Admin authentication
GET  /api/admin/dashboard        # Admin dashboard data
GET  /api/health                 # System health check
GET  /api/init                   # Database initialization (dev only)
```

---

## Troubleshooting Common Issues

### GitHub Authentication Fails:
```bash
# Run setup first
setup_github_environment

# If still failing, user needs to authorize in #github tab
# Do NOT attempt manual git operations without successful setup
```

### Cloudflare Authentication Fails:  
```bash
# Run setup first
setup_cloudflare_api_key

# If failing, user needs to set API key in Deploy tab
# Do NOT attempt wrangler commands without successful setup
```

### Build Failures:
```bash
# Check for syntax errors in TypeScript files
# Common issue: extra braces or missing exports
# Look for error around "export default app;" line
```

### Internal Server Error:
```bash
# Usually missing environment variables
# Ensure JWT_SECRET, ADMIN_USERNAME, ADMIN_PASSWORD are set
# Check Cloudflare Pages environment variables
```

### Port 3000 Already in Use:
```bash
# Clean port before starting
fuser -k 3000/tcp 2>/dev/null || true
pm2 delete all 2>/dev/null || true

# Then start normally
pm2 start ecosystem.config.cjs
```

---

## Admin Access Credentials

### Default Admin Login:
- **Username**: `admin`
- **Password**: `admin123` (development) / `YourSecurePassword123!` (production)
- **Access URL**: `/admin`

### Admin Capabilities:
- Customer management (CRUD operations)
- License administration (create, revoke, monitor)
- Security event monitoring 
- System dashboard and analytics
- Database management and migrations

---

## Security Notes

### Important Security Practices:
1. **Never commit secrets** to git repository
2. **Use .dev.vars** for local development environment variables
3. **Set production secrets** in Cloudflare Pages dashboard only
4. **Rotate JWT secrets** periodically
5. **Monitor security events** through admin panel
6. **Use strong admin passwords** in production

### Data Protection:
- All API communication over HTTPS
- AES-256-GCM encryption for sensitive data
- Hardware fingerprinting for device identification
- Rate limiting and IP blocking for security
- Comprehensive audit logging

---

## Quick Commands Reference

### Essential Commands for New Conversations:
```bash
# Authentication setup (ALWAYS FIRST)
setup_github_environment
setup_cloudflare_api_key

# Project setup
cd /home/user && git clone https://github.com/mreams151/turnkey-app-shield.git
cd turnkey-app-shield && npm install && npm run build

# Development server
fuser -k 3000/tcp 2>/dev/null || true && pm2 start ecosystem.config.cjs

# Database setup
npx wrangler d1 migrations apply turnkey-app-shield-production --local

# Testing
curl http://localhost:3000/api/health
GetServiceUrl(port=3000)

# Production deployment  
npm run deploy:prod
```

---

**Document Created**: September 24, 2025  
**For Project**: TurnkeyAppShield v2.0  
**GitHub**: https://github.com/mreams151/turnkey-app-shield  
**Cloudflare**: turnkey-app-shield.pages.dev  

*This guide provides all necessary information for an AI assistant to connect to and work with your TurnkeyAppShield project in a new conversation session.*